const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/session-logger-CAMlmg_a.js","assets/index-xeh6oSzU.js","assets/index-C5gDw7Rs.css"])))=>i.map(i=>d[i]);
import{a8 as B,r as u,A as J,ao as Z,ap as k,aq as s,c as m,w as O,H as g,a1 as T,a9 as ee}from"./index-xeh6oSzU.js";import{useAudioAnalyser as ae}from"./useAudioAnalyser-L8BEAKYW.js";let E=null;const h=async()=>{if(!E)try{const{useSessionLogger:t}=await T(async()=>{const{useSessionLogger:d}=await import("./session-logger-CAMlmg_a.js");return{useSessionLogger:d}},__vite__mapDeps([0,1,2]));E=t()}catch(t){console.warn("Session logger not available:",t)}return E},ie=B("audio",()=>{const t=u(),d=u(""),r=u(null),j=J(),L=u(null);if(typeof window<"u"){const e=()=>{const o=s.getAudioElement();o&&!t.value&&(t.value=o,console.log("ðŸŽµ Audio element acquired from AudioSystemManager"))};e();const a=setInterval(()=>{e(),t.value&&clearInterval(a)},100)}const q=Z(t,{src:d}),{currentTime:l,duration:v,playing:_,waiting:V,ended:D,volume:$,muted:G,enableTrack:w}=q,b=async()=>{console.log("ðŸ”Š Attempting to play audio...");const e=await s.playAudio();if(e){console.log("ðŸ”Š Audio playing via AudioSystemManager");const a=await h();a&&r.value&&a.logEvent(a.SessionEventType.AUDIO_RESUME,{trackId:r.value,currentTime:l.value,timestamp:Date.now()})}else console.warn("ðŸ”Š AudioSystemManager playAudio() returned false");return e},z=async()=>{s.pauseAudio();const e=await h();e&&r.value&&e.logEvent(e.SessionEventType.AUDIO_PAUSE,{trackId:r.value,currentTime:l.value,timestamp:Date.now()})},{initialize:M,volume:U,stream:P,cleanup:oe,initialized:R}=ae(),x=k();x.add(e=>{if(R.value){const a=s.tick(x.frameRate);U.value=a.volume,P.value=a.stream}},{id:"audio-analysis"});const f=u(!1),y=u(!1),p=m(()=>{const e=s.getState();return e.isPrimed&&e.hasUserGesture}),K=m(()=>l.value*1e3),W=m(()=>v.value*1e3),H=m(()=>v.value>0?l.value/v.value:0);function A(e){console.log("ðŸ”Š Setting audio source:",e),y.value=!0,d.value=e,s.setAudioSource(e)}function C(e){l.value=e}function Q(e){const a=Math.max(0,Math.min(l.value+e,v.value||0));C(a)}function X(e){$.value=Math.max(0,Math.min(1,e))}async function F(){if(p.value)return console.log("ðŸ”Š Audio already initialized via AudioSystemManager"),!0;try{if(console.log("ðŸ”Š Initializing audio system with user gesture..."),s.primeAudioSystem()){t.value=s.getAudioElement();const a=s.getAudioContext(),o=s.getAnalyserNode();return t.value?(await M(t.value),f.value=!0,console.log("ðŸ”Š Audio system + AudioAnalyser initialized successfully!"),!0):(console.warn("ðŸ”Š Missing audio components from AudioSystemManager"),!1)}else return console.warn("ðŸ”Š Failed to prime audio system"),!1}catch(e){return console.error("ðŸ”Š Failed to initialize audio system:",e),!1}}function N(e){if(!e)return null;switch(e.source){case g.SPOTIFY:return console.warn("ðŸ”Š Spotify playback requires Web Playback SDK integration"),null;case g.AUDIUS:const a=e.rawData?.id||e.rawData?.audiusId||e.sourceId;return a?(console.log("ðŸ”Š Audius track ID:",a),`audius-stream:${a}`):(console.warn("ðŸ”Š No track ID found for Audius track:",e),console.warn("ðŸ”Š Available rawData fields:",Object.keys(e.rawData||{})),null);case g.RADIO_PARADISE:case g.KEXP:return console.warn("ðŸ”Š Radio playback not yet implemented"),null;case g.FILE:return e.rawData?.url||e.sourceId;default:return console.warn("ðŸ”Š Unknown audio source:",e.source),null}}function S(e){if(!e||e.id===L.value)return;console.log("ðŸŽµ Now Playing:",e.title,"by",e.artist);const a=`ðŸŽµ Now Playing: "${e.title}" by ${e.artist}`;j.message(a),L.value=e.id}async function I(e){if(!e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=null);return}try{const{useSources:a}=await T(async()=>{const{useSources:i}=await import("./index-xeh6oSzU.js").then(c=>c.ct);return{useSources:i}},__vite__mapDeps([1,2])),n=a().mediaSessionManager.getCurrentConfig();if(!n?.enabled||!n.metadata){console.log("ðŸŽµ Skipping metadata update - current source does not support metadata");return}typeof w=="function"&&t.value&&p.value?(w({title:e.title,artist:e.artist,album:e.album||"",artwork:e.artwork?[{src:e.artwork.small||"",sizes:"64x64",type:"image/jpeg"},{src:e.artwork.medium||"",sizes:"300x300",type:"image/jpeg"},{src:e.artwork.large||"",sizes:"640x640",type:"image/jpeg"}].filter(i=>i.src):[]}),console.log("ðŸŽµ Updated track metadata via useMediaControls for:",e.title)):"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.title,artist:e.artist,album:e.album||"",artwork:e.artwork?[{src:e.artwork.small||"",sizes:"64x64",type:"image/jpeg"},{src:e.artwork.medium||"",sizes:"300x300",type:"image/jpeg"},{src:e.artwork.large||"",sizes:"640x640",type:"image/jpeg"}].filter(i=>i.src):[]}),console.log("ðŸŽµ Updated track metadata via fallback Media Session API for:",e.title))}catch(a){console.warn("Could not update media session metadata:",a)}}async function Y(e){if(!p.value&&(console.log("ðŸ”Š Audio not initialized, initializing now..."),!F()))return console.error("ðŸ”Š Failed to initialize audio"),!1;const a=N(e);if(!a)return console.error("ðŸ”Š No playable audio URL for track:",e),!1;console.log("ðŸ”Š Loading track:",e.title,"by",e.artist),r.value=e.sourceId;const o=await h();if(o&&o.logEvent(o.SessionEventType.AUDIO_TRACK_START,{trackId:e.sourceId,title:e.title,artist:e.artist,album:e.album,source:e.source,duration:e.duration,timestamp:Date.now()}),a.startsWith("audius-stream:")){const n=a.replace("audius-stream:","");try{console.log("ðŸ”Š Fetching Audius stream URL for track ID:",n);const i=await ee.get(`/api/audius/stream/${n}`),{url:c}=i.data;if(c)console.log("ðŸ”Š Got Audius stream URL:",c),A(c),await I(e),S(e);else throw new Error("No stream URL returned")}catch(i){return console.error("ðŸ”Š Failed to fetch Audius stream URL:",i),r.value=null,!1}}else A(a),await I(e),S(e);return console.log("ðŸ”Š Track loaded with autoplay enabled"),!0}return O(D,e=>{e&&(console.log("ðŸ”Š Track ended"),T(async()=>{const{useQueue:a}=await import("./index-xeh6oSzU.js").then(o=>o.cs);return{useQueue:a}},__vite__mapDeps([1,2])).then(({useQueue:a})=>{const o=a();o.hasNext?(console.log("ðŸ”Š Auto-advancing to next track"),o.nextTrack()):console.log("ðŸ”Š End of queue reached")}).catch(a=>{console.warn("Could not auto-advance track:",a)}))}),O(t,async e=>{if(e&&!f.value){console.log("ðŸ”Š Audio element connected from AudioSystemManager"),await M(e),f.value=!0;const a=()=>{console.log("ðŸ”Š Audio can play - loading complete"),y.value=!1},o=()=>{console.log("ðŸ”Š Audio load started"),y.value=!0};e.addEventListener("loadstart",o),e.addEventListener("canplay",a),e.addEventListener("playing",a);const n=()=>{e.removeEventListener("loadstart",o),e.removeEventListener("canplay",a),e.removeEventListener("playing",a)};e._audioLoadingCleanup=n}},{immediate:!0}),{element:t,src:d,playing:_,currentPosition:K,duration:W,progress:H,waiting:V,ended:D,muted:G,isLoading:y,volume:U,stream:P,initialized:m(()=>f.value&&R.value),userGestureInitialized:p,play:b,pause:z,toggle:()=>_.value?z():b(),seek:C,skip:Q,setVolume:X,enableTrack:w,setSource:A,playTrack:Y,getAudioUrlForTrack:N,initializeAudio:F,currentTrackId:r,updateMediaSessionMetadata:I,showNowPlayingToast:S}});export{ie as useAudio};
//# sourceMappingURL=audio-_CqgTru1.js.map
