const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DLc9lyo5.js","assets/index-RgCygfZ2.css"])))=>i.map(i=>d[i]);
import{a7 as Q,r as n,A as X,ag as B,ah as H,ai as i,c as r,w as U,Y as F,C as u}from"./index-DLc9lyo5.js";import{useAudioAnalyser as J}from"./useAudioAnalyser-DvxrcCbY.js";const oe=Q("audio",()=>{const t=n(),y=n(""),v=n(null),R=X(),w=n(null);if(typeof window<"u"){const e=()=>{const o=i.getAudioElement();o&&!t.value&&(t.value=o,console.log("ðŸŽµ Audio element acquired from AudioSystemManager"))};e();const a=setInterval(()=>{e(),t.value&&clearInterval(a)},100)}const N=B(t,{src:y}),{currentTime:d,duration:c,playing:A,waiting:j,ended:S,volume:O,muted:k,enableTrack:p}=N,h=async()=>{console.log("ðŸ”Š Attempting to play audio...");const e=await i.playAudio();return e?console.log("ðŸ”Š Audio playing via AudioSystemManager"):console.warn("ðŸ”Š AudioSystemManager playAudio() returned false"),e},I=async()=>{i.pauseAudio()},{initialize:z,volume:M,stream:b,cleanup:Z,initialized:E}=J(),T=H();T.add(e=>{if(E.value){const a=i.tick(T.frameRate);M.value=a.volume,b.value=a.stream}},{id:"audio-analysis"});const m=n(!1),g=n(!1),f=r(()=>{const e=i.getState();return e.isPrimed&&e.hasUserGesture}),q=r(()=>d.value*1e3),V=r(()=>c.value*1e3),$=r(()=>c.value>0?d.value/c.value:0);function L(e){console.log("ðŸ”Š Setting audio source:",e),g.value=!0,y.value=e,i.setAudioSource(e)}function D(e){d.value=e}function G(e){const a=Math.max(0,Math.min(d.value+e,c.value||0));D(a)}function K(e){O.value=Math.max(0,Math.min(1,e))}async function x(){if(f.value)return console.log("ðŸ”Š Audio already initialized via AudioSystemManager"),!0;try{if(console.log("ðŸ”Š Initializing audio system with user gesture..."),i.primeAudioSystem()){t.value=i.getAudioElement();const a=i.getAudioContext(),o=i.getAnalyserNode();return t.value?(await z(t.value),m.value=!0,console.log("ðŸ”Š Audio system + AudioAnalyser initialized successfully!"),!0):(console.warn("ðŸ”Š Missing audio components from AudioSystemManager"),!1)}else return console.warn("ðŸ”Š Failed to prime audio system"),!1}catch(e){return console.error("ðŸ”Š Failed to initialize audio system:",e),!1}}function P(e){if(!e)return null;switch(e.source){case u.SPOTIFY:return console.warn("ðŸ”Š Spotify playback requires Web Playback SDK integration"),null;case u.AUDIUS:const a=e.rawData?.id||e.rawData?.audiusId||e.sourceId;return a?(console.log("ðŸ”Š Audius track ID:",a),`audius-stream:${a}`):(console.warn("ðŸ”Š No track ID found for Audius track:",e),console.warn("ðŸ”Š Available rawData fields:",Object.keys(e.rawData||{})),null);case u.RADIO_PARADISE:case u.KEXP:return console.warn("ðŸ”Š Radio playback not yet implemented"),null;case u.FILE:return e.rawData?.url||e.sourceId;default:return console.warn("ðŸ”Š Unknown audio source:",e.source),null}}function _(e){if(!e||e.id===w.value)return;console.log("ðŸŽµ Now Playing:",e.title,"by",e.artist);const a=`ðŸŽµ Now Playing: "${e.title}" by ${e.artist}`;R.message(a),w.value=e.id}async function C(e){if(!e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=null);return}try{const{useSources:a}=await F(async()=>{const{useSources:l}=await import("./index-DLc9lyo5.js").then(Y=>Y.an);return{useSources:l}},__vite__mapDeps([0,1])),s=a().mediaSessionManager.getCurrentConfig();if(!s?.enabled||!s.metadata){console.log("ðŸŽµ Skipping metadata update - current source does not support metadata");return}typeof p=="function"&&t.value&&f.value?(p({title:e.title,artist:e.artist,album:e.album||"",artwork:e.artwork?[{src:e.artwork.small||"",sizes:"64x64",type:"image/jpeg"},{src:e.artwork.medium||"",sizes:"300x300",type:"image/jpeg"},{src:e.artwork.large||"",sizes:"640x640",type:"image/jpeg"}].filter(l=>l.src):[]}),console.log("ðŸŽµ Updated track metadata via useMediaControls for:",e.title)):"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.title,artist:e.artist,album:e.album||"",artwork:e.artwork?[{src:e.artwork.small||"",sizes:"64x64",type:"image/jpeg"},{src:e.artwork.medium||"",sizes:"300x300",type:"image/jpeg"},{src:e.artwork.large||"",sizes:"640x640",type:"image/jpeg"}].filter(l=>l.src):[]}),console.log("ðŸŽµ Updated track metadata via fallback Media Session API for:",e.title))}catch(a){console.warn("Could not update media session metadata:",a)}}async function W(e){if(!f.value&&(console.log("ðŸ”Š Audio not initialized, initializing now..."),!x()))return console.error("ðŸ”Š Failed to initialize audio"),!1;const a=P(e);if(!a)return console.error("ðŸ”Š No playable audio URL for track:",e),!1;if(console.log("ðŸ”Š Loading track:",e.title,"by",e.artist),v.value=e.sourceId,a.startsWith("audius-stream:")){const o=a.replace("audius-stream:","");try{console.log("ðŸ”Š Fetching Audius stream URL for track ID:",o)}catch(s){return console.error("ðŸ”Š Failed to fetch Audius stream URL:",s),v.value=null,!1}}else L(a),await C(e),_(e);return console.log("ðŸ”Š Track loaded with autoplay enabled"),!0}return U(S,e=>{e&&(console.log("ðŸ”Š Track ended"),F(async()=>{const{useQueue:a}=await import("./index-DLc9lyo5.js").then(o=>o.am);return{useQueue:a}},__vite__mapDeps([0,1])).then(({useQueue:a})=>{const o=a();o.hasNext?(console.log("ðŸ”Š Auto-advancing to next track"),o.nextTrack()):console.log("ðŸ”Š End of queue reached")}).catch(a=>{console.warn("Could not auto-advance track:",a)}))}),U(t,async e=>{if(e&&!m.value){console.log("ðŸ”Š Audio element connected from AudioSystemManager"),await z(e),m.value=!0;const a=()=>{console.log("ðŸ”Š Audio can play - loading complete"),g.value=!1},o=()=>{console.log("ðŸ”Š Audio load started"),g.value=!0};e.addEventListener("loadstart",o),e.addEventListener("canplay",a),e.addEventListener("playing",a);const s=()=>{e.removeEventListener("loadstart",o),e.removeEventListener("canplay",a),e.removeEventListener("playing",a)};e._audioLoadingCleanup=s}},{immediate:!0}),{element:t,src:y,playing:A,currentPosition:q,duration:V,progress:$,waiting:j,ended:S,muted:k,isLoading:g,volume:M,stream:b,initialized:r(()=>m.value&&E.value),userGestureInitialized:f,play:h,pause:I,toggle:()=>A.value?I():h(),seek:D,skip:G,setVolume:K,enableTrack:p,setSource:L,playTrack:W,getAudioUrlForTrack:P,initializeAudio:x,currentTrackId:v,updateMediaSessionMetadata:C,showNowPlayingToast:_}});export{oe as useAudio};
//# sourceMappingURL=audio-DtvIm3ZE.js.map
